<Page x:Class="Sundy.Uno.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Sundy.Uno"
      xmlns:vm="using:Sundy.Uno.ViewModels"
      xmlns:views="using:Sundy.Uno.Views"
      Background="{ThemeResource BackgroundPrimary}">

    <Grid x:Name="RootGrid">
        <!-- Main content with optional sidebar -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Desktop Sidebar (collapsible) -->
            <Border Grid.Column="0"
                    x:Name="DesktopSidebar"
                    Visibility="{x:Bind ViewModel.IsDesktopSidebarVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                    Width="260"
                    Margin="6,6,0,6"
                    Background="{ThemeResource BackgroundTertiary}"
                    CornerRadius="12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="38" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Title Bar Area -->
                    <Border Grid.Row="0" Background="Transparent">
                        <TextBlock Text="My Calendars"
                                   FontWeight="SemiBold"
                                   FontSize="13"
                                   Foreground="{ThemeResource ForegroundPrimary}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                    </Border>

                    <!-- Calendar List -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="4" Margin="12,0,12,12">
                            <ItemsRepeater ItemsSource="{x:Bind ViewModel.Calendars, Mode=OneWay}">
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="vm:CalendarListItemViewModel">
                                        <Border Background="Transparent"
                                                CornerRadius="8"
                                                Padding="8,10"
                                                Margin="0,1">
                                            <CheckBox IsChecked="{x:Bind IsVisible, Mode=TwoWay}">
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Ellipse Width="10"
                                                             Height="10"
                                                             Fill="{x:Bind Color, Mode=OneWay}" />
                                                    <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                               FontSize="13"
                                                               Foreground="{ThemeResource ForegroundPrimary}" />
                                                </StackPanel>
                                            </CheckBox>
                                        </Border>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>

                            <Button Command="{x:Bind ViewModel.CreateNewCalendarCommand}"
                                    Visibility="{x:Bind ViewModel.HasNoCalendars, Mode=OneWay}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Left"
                                    Margin="4,10,0,0">
                                <StackPanel Orientation="Horizontal" Spacing="7">
                                    <FontIcon Glyph="&#xE710;"
                                              FontSize="12"
                                              VerticalAlignment="Center" />
                                    <TextBlock Text="New Local Calendar" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Settings Button -->
                    <Border Grid.Row="2"
                            BorderBrush="{ThemeResource BorderBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="12,8">
                        <Button Command="{x:Bind ViewModel.OpenSettingsCommand}"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8,10"
                                CornerRadius="8"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <FontIcon Glyph="&#xE713;"
                                          FontSize="16"
                                          Foreground="{ThemeResource ForegroundMuted}" />
                                <TextBlock Text="Settings"
                                           FontSize="13"
                                           Foreground="{ThemeResource ForegroundMuted}" />
                            </StackPanel>
                        </Button>
                    </Border>
                </Grid>
            </Border>

            <!-- Main Calendar Content -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Top Navigation Bar -->
                <Grid Grid.Row="0" Padding="8,8" ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Left controls -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6">
                        <!-- Hamburger menu -->
                        <Button Command="{x:Bind ViewModel.ToggleSidebarPanelCommand}"
                                Visibility="{x:Bind ViewModel.IsMobileLayout, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="10"
                                MinWidth="40"
                                Height="36"
                                VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE700;"
                                      FontSize="14"
                                      Foreground="{ThemeResource ForegroundPrimary}" />
                        </Button>
                        <Button Command="{x:Bind ViewModel.ToggleSidebarCommand}"
                                Visibility="{x:Bind ViewModel.IsMobileLayout, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="10"
                                MinWidth="40"
                                Height="36"
                                VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE700;"
                                      FontSize="14"
                                      Foreground="{ThemeResource ForegroundPrimary}" />
                        </Button>

                        <!-- Today pill button -->
                        <Button Command="{x:Bind ViewModel.GoToTodayCommand}"
                                Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="18"
                                Padding="16,0"
                                Height="36"
                                VerticalAlignment="Center">
                            <TextBlock Text="Today"
                                       FontSize="13"
                                       Foreground="{ThemeResource ForegroundPrimary}" />
                        </Button>

                        <!-- Previous button - standalone pill -->
                        <Button Command="{x:Bind ViewModel.PreviousPeriodCommand}"
                                Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="18"
                                Padding="12,0"
                                MinWidth="40"
                                Height="36"
                                VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE76B;"
                                      FontSize="12"
                                      Foreground="{ThemeResource ForegroundPrimary}" />
                        </Button>

                        <!-- Next button - standalone pill -->
                        <Button Command="{x:Bind ViewModel.NextPeriodCommand}"
                                Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="18"
                                Padding="12,0"
                                MinWidth="40"
                                Height="36"
                                VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE76C;"
                                      FontSize="12"
                                      Foreground="{ThemeResource ForegroundPrimary}" />
                        </Button>

                        <!-- Current period display -->
                        <TextBlock Text="{x:Bind ViewModel.CurrentPeriodDisplay, Mode=OneWay}"
                                   VerticalAlignment="Center"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{ThemeResource ForegroundPrimary}"
                                   Margin="8,0,0,0" />
                    </StackPanel>

                    <!-- Right controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <!-- View Mode Segmented Control -->
                        <Border Background="{ThemeResource BackgroundTertiary}"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="18"
                                Padding="3"
                                Height="36"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="2">
                                <Button Command="{x:Bind ViewModel.SetDayViewCommand}"
                                        Background="{x:Bind ViewModel.IsDayView, Mode=OneWay, Converter={StaticResource BoolToAccentBackgroundConverter}}"
                                        BorderThickness="0"
                                        Padding="14,0"
                                        Height="28"
                                        CornerRadius="14">
                                    <TextBlock Text="Day"
                                               FontSize="13"
                                               Foreground="{ThemeResource ForegroundPrimary}" />
                                </Button>
                                <Button Command="{x:Bind ViewModel.SetWeekViewCommand}"
                                        Background="{x:Bind ViewModel.IsWeekView, Mode=OneWay, Converter={StaticResource BoolToAccentBackgroundConverter}}"
                                        BorderThickness="0"
                                        Padding="14,0"
                                        Height="28"
                                        CornerRadius="14">
                                    <TextBlock Text="Week"
                                               FontSize="13"
                                               Foreground="{ThemeResource ForegroundPrimary}" />
                                </Button>
                                <Button Command="{x:Bind ViewModel.SetMonthViewCommand}"
                                        Background="{x:Bind ViewModel.IsMonthView, Mode=OneWay, Converter={StaticResource BoolToAccentBackgroundConverter}}"
                                        BorderThickness="0"
                                        Padding="14,0"
                                        Height="28"
                                        CornerRadius="14">
                                    <TextBlock Text="Month"
                                               FontSize="13"
                                               Foreground="{ThemeResource ForegroundPrimary}" />
                                </Button>
                            </StackPanel>
                        </Border>

                        <!-- New Event button -->
                        <Button Command="{x:Bind ViewModel.CreateEventCommand}"
                                Background="{ThemeResource AccentPrimary}"
                                BorderThickness="0"
                                CornerRadius="18"
                                Padding="14,0"
                                Height="36"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xECC8;"
                                          FontSize="16"
                                          Foreground="White" />
                                <TextBlock Text="New Event"
                                           FontSize="13"
                                           Foreground="White"
                                           FontWeight="SemiBold" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Calendar View -->
                <Border Grid.Row="1"
                        Margin="6,0,6,6"
                        Background="{ThemeResource BackgroundPrimary}"
                        BorderBrush="{ThemeResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="12">
                    <ContentControl Content="{x:Bind ViewModel.CalendarViewModel, Mode=OneWay}"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch">
                        <ContentControl.ContentTemplate>
                            <DataTemplate x:DataType="vm:CalendarViewModel">
                                <views:CalendarView HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Stretch" />
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </Border>
            </Grid>
        </Grid>

        <!-- Mobile Sidebar Overlay -->
        <Grid Visibility="{x:Bind ViewModel.IsMobileLayout, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <!-- Backdrop -->
            <Border Background="{ThemeResource ModalOverlay}"
                    Visibility="{x:Bind ViewModel.IsSidebarOpen, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                    Tapped="OnSidebarBackdropTapped" />

            <!-- Mobile Sidebar panel -->
            <Border HorizontalAlignment="Left"
                    Width="280"
                    Margin="6"
                    Background="{ThemeResource BackgroundTertiary}"
                    BorderBrush="{ThemeResource AccentSubtle}"
                    BorderThickness="1"
                    CornerRadius="12"
                    IsHitTestVisible="{x:Bind ViewModel.IsSidebarOpen, Mode=OneWay}"
                    Tapped="OnSidebarContentTapped">
                <Border.RenderTransform>
                    <TranslateTransform X="{x:Bind ViewModel.SidebarTranslateX, Mode=OneWay}" />
                </Border.RenderTransform>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="4" Margin="12">
                            <TextBlock Text="My Calendars"
                                       FontWeight="SemiBold"
                                       FontSize="13"
                                       Foreground="{ThemeResource ForegroundMuted}"
                                       Margin="4,8,4,8" />

                            <ItemsRepeater ItemsSource="{x:Bind ViewModel.Calendars, Mode=OneWay}">
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="vm:CalendarListItemViewModel">
                                        <Border Background="Transparent"
                                                CornerRadius="8"
                                                Padding="8,10"
                                                Margin="0,1">
                                            <CheckBox IsChecked="{x:Bind IsVisible, Mode=TwoWay}">
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Ellipse Width="10"
                                                             Height="10"
                                                             Fill="{x:Bind Color, Mode=OneWay}" />
                                                    <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                               FontSize="13"
                                                               Foreground="{ThemeResource ForegroundPrimary}" />
                                                </StackPanel>
                                            </CheckBox>
                                        </Border>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>

                            <Button Command="{x:Bind ViewModel.CreateNewCalendarCommand}"
                                    Visibility="{x:Bind ViewModel.HasNoCalendars, Mode=OneWay}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Left"
                                    Margin="4,10,0,0">
                                <StackPanel Orientation="Horizontal" Spacing="7">
                                    <FontIcon Glyph="&#xE710;"
                                              FontSize="12"
                                              VerticalAlignment="Center" />
                                    <TextBlock Text="New Local Calendar" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </ScrollViewer>

                    <Border Grid.Row="1"
                            BorderBrush="{ThemeResource BorderBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="12,8">
                        <Button Command="{x:Bind ViewModel.OpenSettingsCommand}"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8,10"
                                CornerRadius="8"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <FontIcon Glyph="&#xE713;"
                                          FontSize="16"
                                          Foreground="{ThemeResource ForegroundMuted}" />
                                <TextBlock Text="Settings"
                                           FontSize="13"
                                           Foreground="{ThemeResource ForegroundMuted}" />
                            </StackPanel>
                        </Button>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
