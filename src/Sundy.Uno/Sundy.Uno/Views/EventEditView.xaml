<UserControl x:Class="Sundy.Uno.Views.EventEditView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Sundy.Uno.ViewModels"
             xmlns:core="using:Sundy.Core"
             Width="580"
             MinHeight="520">

    <Border Background="#2D2D2D"
            BorderBrush="{ThemeResource ModalBorder}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="32"
            Translation="0,0,32">
        <Border.Shadow>
            <ThemeShadow />
        </Border.Shadow>

        <Grid RowSpacing="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header with Title and Calendar Selector -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{x:Bind ViewModel.DialogTitle, Mode=OneWay}"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center" />

                <!-- Calendar Selector Button -->
                <Button Grid.Column="1"
                        IsEnabled="{x:Bind ViewModel.IsBlockingEvent, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="12,8"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        x:Name="CalendarSelectorButton">
                    <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedRight">
                            <Border Background="#1E1E1E"
                                    BorderBrush="#3D3D3D"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Padding="8"
                                    MinWidth="220">
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.AvailableCalendars, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="core:Calendar">
                                            <Button Click="CalendarItem_Click"
                                                    Tag="{x:Bind}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    CornerRadius="8"
                                                    HorizontalAlignment="Stretch"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="12,10">
                                                <StackPanel Orientation="Horizontal" Spacing="12">
                                                    <Border Width="18"
                                                            Height="18"
                                                            Background="{x:Bind Color}"
                                                            CornerRadius="4" />
                                                    <TextBlock Text="{x:Bind Name}"
                                                               FontSize="14"
                                                               VerticalAlignment="Center"
                                                               Foreground="White" />
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </Border>
                        </Flyout>
                    </Button.Flyout>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Border Width="18"
                                Height="18"
                                Background="{x:Bind ViewModel.SelectedCalendar.Color, Mode=OneWay}"
                                CornerRadius="4"
                                Visibility="{x:Bind ViewModel.SelectedCalendar, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}" />
                        <TextBlock Text="{x:Bind ViewModel.SelectedCalendar.Name, FallbackValue='My Calendar', Mode=OneWay}"
                                   FontSize="15"
                                   Foreground="#B0B0B0"
                                   VerticalAlignment="Center" />
                        <FontIcon Glyph="&#xE70D;"
                                  FontSize="11"
                                  Foreground="#808080"
                                  VerticalAlignment="Center"
                                  Margin="2,1,0,0" />
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Form Content -->
            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          Padding="0,0,4,0">
                <StackPanel Spacing="24">

                    <!-- Title Field -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="Title *"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="White" />
                        <TextBox Text="{x:Bind ViewModel.Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 PlaceholderText="Event title"
                                 IsEnabled="{x:Bind ViewModel.IsBlockingEvent, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                                 Background="#1A1A1A"
                                 BorderBrush="#3D3D3D"
                                 BorderThickness="1"
                                 CornerRadius="10"
                                 Padding="16,14"
                                 FontSize="15" />
                    </StackPanel>

                    <!-- Date & Time Section -->
                    <StackPanel Spacing="14">
                        <TextBlock Text="Date &amp; Time *"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="White" />

                        <!-- Date Time Card -->
                        <Border Background="#1A1A1A"
                                BorderBrush="#3D3D3D"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="18,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Calendar Icon -->
                                <Border Grid.Column="0"
                                        Width="56"
                                        Height="56"
                                        Background="{ThemeResource AccentPrimary}"
                                        CornerRadius="10"
                                        Margin="0,0,18,0">
                                    <FontIcon Glyph="&#xE787;"
                                              FontSize="26"
                                              Foreground="White"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                                </Border>

                                <!-- Date and Time Display -->
                                <StackPanel Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Spacing="4">
                                    <TextBlock Text="{x:Bind ViewModel.FormattedDate, Mode=OneWay}"
                                               FontSize="17"
                                               FontWeight="SemiBold"
                                               Foreground="White" />
                                    <TextBlock Text="{x:Bind ViewModel.FormattedTimeRange, Mode=OneWay}"
                                               FontSize="15"
                                               Foreground="#B0B0B0" />
                                    <TextBlock Text="{x:Bind ViewModel.FormattedDuration, Mode=OneWay}"
                                               FontSize="13"
                                               Foreground="#707070" />
                                </StackPanel>

                                <!-- Edit Button -->
                                <Button Grid.Column="2"
                                        Command="{x:Bind ViewModel.OpenSchedulerCommand}"
                                        IsEnabled="{x:Bind ViewModel.IsBlockingEvent, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="12"
                                        VerticalAlignment="Center"
                                        CornerRadius="8">
                                    <FontIcon Glyph="&#xE70F;"
                                              FontSize="18"
                                              Foreground="#909090" />
                                </Button>
                            </Grid>
                        </Border>

                        <!-- All Day Checkbox -->
                        <CheckBox Content="All day event"
                                  Margin="4,4,0,0"
                                  IsChecked="{x:Bind ViewModel.IsAllDay, Mode=TwoWay}"
                                  IsEnabled="{x:Bind ViewModel.IsBlockingEvent, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                                  Foreground="#C0C0C0" />
                    </StackPanel>

                    <!-- Description Field -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="Description"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="White" />
                        <TextBox Text="{x:Bind ViewModel.Description, Mode=TwoWay}"
                                 PlaceholderText="Add description"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 MinHeight="120"
                                 MaxHeight="200"
                                 IsEnabled="{x:Bind ViewModel.IsBlockingEvent, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                                 Background="#1A1A1A"
                                 BorderBrush="#3D3D3D"
                                 BorderThickness="1"
                                 CornerRadius="10"
                                 Padding="16,14"
                                 FontSize="15" />
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Action Buttons -->
            <Grid Grid.Row="2" ColumnSpacing="14" Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Delete Button (edit mode only) -->
                <Button Grid.Column="0"
                        Content="Delete"
                        Command="{x:Bind ViewModel.DeleteCommand}"
                        Background="#DC2626"
                        Foreground="White"
                        CornerRadius="22"
                        Padding="28,0"
                        Height="44"
                        FontSize="15"
                        FontWeight="SemiBold"
                        Visibility="{x:Bind ViewModel.IsEditMode, Mode=OneWay}" />

                <!-- Cancel Button -->
                <Button Grid.Column="2"
                        Content="Cancel"
                        Command="{x:Bind ViewModel.CancelCommand}"
                        Background="#1A1A1A"
                        Foreground="White"
                        BorderBrush="#3D3D3D"
                        BorderThickness="1"
                        CornerRadius="22"
                        Padding="32,0"
                        Height="44"
                        FontSize="15"
                        FontWeight="SemiBold" />

                <!-- Create/Save Button -->
                <Button Grid.Column="3"
                        Content="{x:Bind ViewModel.SaveButtonText, Mode=OneWay}"
                        Command="{x:Bind ViewModel.SaveCommand}"
                        Background="{ThemeResource AccentPrimary}"
                        Foreground="White"
                        BorderThickness="0"
                        CornerRadius="22"
                        Padding="32,0"
                        Height="44"
                        FontSize="15"
                        FontWeight="SemiBold" />
            </Grid>
        </Grid>
    </Border>
</UserControl>
