<UserControl
    x:Class="Sundy.Uno.Views.CalendarSettingsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:Sundy.Uno.ViewModels">

    <Border Background="{ThemeResource ModalBackground}"
            BorderBrush="{ThemeResource ModalBorder}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="24"
            MaxWidth="700"
            MinWidth="500"
            Translation="0, 0, 32">
        <Border.Shadow>
            <ThemeShadow />
        </Border.Shadow>

        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="24">
            <!-- Header -->
            <TextBlock Grid.Row="0"
                       Text="Settings"
                       Style="{StaticResource DialogTitle}" />

            <!-- Content -->
            <ScrollViewer Grid.Row="1" MaxHeight="500">
                <StackPanel Spacing="20">
                    <!-- Calendar List -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="Calendars"
                                   Style="{StaticResource SectionHeader}" />

                        <!-- Empty state -->
                        <TextBlock Text="No calendars yet. Create one below."
                                   Foreground="{ThemeResource ForegroundDisabled}"
                                   FontStyle="Italic"
                                   Visibility="{x:Bind ViewModel.Calendars.Count, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}" />

                        <!-- Calendar items -->
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.Calendars, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <StackLayout Spacing="8" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="vm:CalendarItemViewModel">
                                    <Border BorderBrush="{ThemeResource BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="16"
                                            Background="{ThemeResource BackgroundSecondary}">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                            <!-- Calendar Color -->
                                            <Border Grid.Column="0"
                                                    Width="24"
                                                    Height="24"
                                                    CornerRadius="6"
                                                    VerticalAlignment="Center">
                                                <Border.Background>
                                                    <SolidColorBrush Color="{x:Bind Color, Mode=OneWay}" />
                                                </Border.Background>
                                            </Border>

                                            <!-- Calendar Name -->
                                            <TextBlock Grid.Column="1"
                                                       Text="{x:Bind Name, Mode=OneWay}"
                                                       Style="{StaticResource ItemTitle}"
                                                       VerticalAlignment="Center" />

                                            <!-- Delete Button -->
                                            <Button Grid.Column="2"
                                                    Content="Delete"
                                                    Command="{x:Bind DeleteCommand, Mode=OneWay}"
                                                    Style="{StaticResource DangerButton}"
                                                    VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </StackPanel>

                    <!-- New Calendar Section -->
                    <Border BorderBrush="{ThemeResource BorderBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="0,20,0,0">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Create New Calendar"
                                       Style="{StaticResource SectionHeader}" />

                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <TextBox Grid.Column="0"
                                         Text="{x:Bind ViewModel.NewCalendarName, Mode=TwoWay}"
                                         PlaceholderText="Calendar name"
                                         Height="36" />
                                <Button Grid.Column="1"
                                        Content="Create"
                                        Command="{x:Bind ViewModel.CreateCalendarCommand, Mode=OneWay}"
                                        Style="{StaticResource AccentButton}"
                                        MinWidth="100" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Database Management Section -->
                    <Border BorderBrush="{ThemeResource BorderBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="0,20,0,0">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Database Management"
                                       Style="{StaticResource SectionHeader}" />

                            <TextBlock TextWrapping="Wrap"
                                       Foreground="{ThemeResource ForegroundSecondary}"
                                       FontSize="13"
                                       Text="Warning: This will permanently delete all local data. This action cannot be undone." />

                            <Button Content="Reset Database"
                                    Command="{x:Bind ViewModel.ResetDatabaseCommand, Mode=OneWay}"
                                    Style="{StaticResource DangerButton}"
                                    HorizontalAlignment="Left"
                                    MinWidth="150"
                                    IsEnabled="{x:Bind ViewModel.IsResettingDatabase, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer Actions -->
            <Grid Grid.Row="2" ColumnDefinitions="*,Auto" ColumnSpacing="12">
                <Button Grid.Column="1"
                        Content="Close"
                        Command="{x:Bind ViewModel.CloseCommand, Mode=OneWay}"
                        Style="{StaticResource AccentButton}"
                        MinWidth="100" />
            </Grid>
        </Grid>
    </Border>
</UserControl>
