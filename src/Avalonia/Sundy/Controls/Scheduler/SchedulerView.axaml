<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:scheduler="using:Sundy.Controls.Scheduler"
             xmlns:vm="using:Sundy.ViewModels.Scheduler"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="700"
             x:Class="Sundy.Controls.Scheduler.SchedulerView"
             x:DataType="vm:SchedulerViewModel"
             Background="{DynamicResource BackgroundPrimary}">

    <Grid RowDefinitions="Auto,*">

        <!-- Week Header -->
        <Border Grid.Row="0" Background="{DynamicResource BackgroundSecondary}" Padding="8,12">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Previous Week button -->
                <Button Grid.Column="0"
                        Command="{Binding NavigatePreviousWeekCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="8"
                        VerticalAlignment="Center"
                        Cursor="Hand">
                    <Path Data="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"
                          Width="20" Height="20"
                          Fill="{DynamicResource ForegroundPrimary}"
                          Stretch="Uniform" />
                </Button>

                <!-- Month/Year and week days -->
                <StackPanel Grid.Column="1" Spacing="12">
                    <!-- Title row with settings icon and month -->
                    <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Left">
                        <Path Data="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                              Width="20" Height="20"
                              Stroke="{DynamicResource ForegroundMuted}"
                              StrokeThickness="2"
                              Stretch="Uniform" />
                        <TextBlock Text="{Binding SelectedDate, StringFormat=MMMM}"
                                   FontSize="18"
                                   Foreground="{DynamicResource ForegroundPrimary}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Week days grid -->
                    <ItemsControl ItemsSource="{Binding DayItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="7"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:DayItemViewModel">
                                <Button Command="{Binding $parent[ItemsControl].((vm:SchedulerViewModel)DataContext).SelectDateCommand}"
                                        CommandParameter="{Binding Date}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="4"
                                        Cursor="Hand">
                                    <StackPanel HorizontalAlignment="Center" Spacing="4">
                                        <TextBlock Text="{Binding DayOfWeekShort}" FontSize="12"
                                                   Foreground="{DynamicResource ForegroundMuted}" HorizontalAlignment="Center"/>
                                        <Border CornerRadius="16" Width="32" Height="32" HorizontalAlignment="Center"
                                                Classes.selected="{Binding IsSelected}"
                                                Classes.today="{Binding IsToday}">
                                            <Border.Styles>
                                                <Style Selector="Border">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                </Style>
                                                <Style Selector="Border.today:not(.selected)">
                                                    <Setter Property="Background" Value="#404040"/>
                                                </Style>
                                                <Style Selector="Border.selected">
                                                    <Setter Property="Background" Value="{DynamicResource AccentPrimary}"/>
                                                </Style>
                                            </Border.Styles>
                                            <TextBlock Text="{Binding DayNumber}" FontSize="14" FontWeight="Medium"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Classes.selected="{Binding IsSelected}">
                                                <TextBlock.Styles>
                                                    <Style Selector="TextBlock">
                                                        <Setter Property="Foreground" Value="{DynamicResource ForegroundMuted}"/>
                                                    </Style>
                                                    <Style Selector="TextBlock.selected">
                                                        <Setter Property="Foreground" Value="{DynamicResource ForegroundOnAccent}"/>
                                                    </Style>
                                                </TextBlock.Styles>
                                            </TextBlock>
                                        </Border>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Next Week button -->
                <Button Grid.Column="2"
                        Command="{Binding NavigateNextWeekCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="8"
                        VerticalAlignment="Center"
                        Cursor="Hand">
                    <Path Data="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"
                          Width="20" Height="20"
                          Fill="{DynamicResource ForegroundPrimary}"
                          Stretch="Uniform" />
                </Button>
            </Grid>
        </Border>

        <!-- Time Grid with ScrollViewer -->
        <ScrollViewer x:Name="TimeGridScrollViewer"
                      Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <Canvas Height="{Binding TotalHeight}"
                    Background="{DynamicResource BackgroundPrimary}"
                    ClipToBounds="True">
                <!-- Hour lines (hardcoded) -->
                <!-- 12 AM -->
                <TextBlock Text="12 AM" Canvas.Left="8" Canvas.Top="0" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="0"/>

                <!-- 1 AM -->
                <TextBlock Text="1 AM" Canvas.Left="8" Canvas.Top="60" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="60"/>

                <!-- 2 AM -->
                <TextBlock Text="2 AM" Canvas.Left="8" Canvas.Top="120" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="120"/>

                <!-- 3 AM -->
                <TextBlock Text="3 AM" Canvas.Left="8" Canvas.Top="180" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="180"/>

                <!-- 4 AM -->
                <TextBlock Text="4 AM" Canvas.Left="8" Canvas.Top="240" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="240"/>

                <!-- 5 AM -->
                <TextBlock Text="5 AM" Canvas.Left="8" Canvas.Top="300" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="300"/>

                <!-- 6 AM -->
                <TextBlock Text="6 AM" Canvas.Left="8" Canvas.Top="360" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="360"/>

                <!-- 7 AM -->
                <TextBlock Text="7 AM" Canvas.Left="8" Canvas.Top="420" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="420"/>

                <!-- 8 AM -->
                <TextBlock Text="8 AM" Canvas.Left="8" Canvas.Top="480" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="480"/>

                <!-- 9 AM -->
                <TextBlock Text="9 AM" Canvas.Left="8" Canvas.Top="540" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="540"/>

                <!-- 10 AM -->
                <TextBlock Text="10 AM" Canvas.Left="8" Canvas.Top="600" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="600"/>

                <!-- 11 AM -->
                <TextBlock Text="11 AM" Canvas.Left="8" Canvas.Top="660" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="660"/>

                <!-- 12 PM -->
                <TextBlock Text="12 PM" Canvas.Left="8" Canvas.Top="720" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="720"/>

                <!-- 1 PM -->
                <TextBlock Text="1 PM" Canvas.Left="8" Canvas.Top="780" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="780"/>

                <!-- 2 PM -->
                <TextBlock Text="2 PM" Canvas.Left="8" Canvas.Top="840" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="840"/>

                <!-- 3 PM -->
                <TextBlock Text="3 PM" Canvas.Left="8" Canvas.Top="900" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="900"/>

                <!-- 4 PM -->
                <TextBlock Text="4 PM" Canvas.Left="8" Canvas.Top="960" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="960"/>

                <!-- 5 PM -->
                <TextBlock Text="5 PM" Canvas.Left="8" Canvas.Top="1020" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1020"/>

                <!-- 6 PM -->
                <TextBlock Text="6 PM" Canvas.Left="8" Canvas.Top="1080" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1080"/>

                <!-- 7 PM -->
                <TextBlock Text="7 PM" Canvas.Left="8" Canvas.Top="1140" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1140"/>

                <!-- 8 PM -->
                <TextBlock Text="8 PM" Canvas.Left="8" Canvas.Top="1200" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1200"/>

                <!-- 9 PM -->
                <TextBlock Text="9 PM" Canvas.Left="8" Canvas.Top="1260" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1260"/>

                <!-- 10 PM -->
                <TextBlock Text="10 PM" Canvas.Left="8" Canvas.Top="1320" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1320"/>

                <!-- 11 PM -->
                <TextBlock Text="11 PM" Canvas.Left="8" Canvas.Top="1380" Foreground="{DynamicResource SchedulerTimeText}" FontSize="11"/>
                <Rectangle Height="1" Fill="{DynamicResource SchedulerLine}" Width="1000" Canvas.Left="60" Canvas.Top="1380"/>

                <!-- Current time indicator -->
                <scheduler:CurrentTimeIndicator CurrentTime="{Binding CurrentTime}"
                                                 IndicatorBrush="{DynamicResource AccentPrimary}"
                                                 Width="1000"
                                                 Canvas.Left="0">
                    <Canvas.Top>
                        <MultiBinding Converter="{x:Static scheduler:TimeToCanvasTopConverter.Instance}">
                            <Binding Path="CurrentTime"/>
                            <Binding Path="PixelsPerMinute"/>
                        </MultiBinding>
                    </Canvas.Top>
                </scheduler:CurrentTimeIndicator>

                <!-- Time block selector -->
                <scheduler:TimeBlockControl TimeBlock="{Binding TimeBlock}"
                                             PixelsPerMinute="{Binding PixelsPerMinute}"
                                             Canvas.Left="70"
                                             Canvas.Right="10">
                    <scheduler:TimeBlockControl.Width>
                        <Binding Path="Bounds.Width" RelativeSource="{RelativeSource AncestorType=Canvas}">
                            <Binding.Converter>
                                <scheduler:SubtractConverter Offset="80"/>
                            </Binding.Converter>
                        </Binding>
                    </scheduler:TimeBlockControl.Width>
                    <Canvas.Top>
                        <MultiBinding Converter="{x:Static scheduler:TimeToCanvasTopConverter.Instance}">
                            <Binding Path="TimeBlock.StartTime"/>
                            <Binding Path="PixelsPerMinute"/>
                        </MultiBinding>
                    </Canvas.Top>
                    <scheduler:TimeBlockControl.Height>
                        <MultiBinding Converter="{x:Static scheduler:DurationToHeightConverter.Instance}">
                            <Binding Path="TimeBlock.StartTime"/>
                            <Binding Path="TimeBlock.EndTime"/>
                            <Binding Path="PixelsPerMinute"/>
                        </MultiBinding>
                    </scheduler:TimeBlockControl.Height>
                </scheduler:TimeBlockControl>

            </Canvas>
        </ScrollViewer>

    </Grid>

</UserControl>
