<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Sundy.ViewModels"
             xmlns:views="using:Sundy.Views"
             xmlns:controls="using:Sundy.Controls"
             xmlns:avalonia="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
             x:Class="Sundy.Views.MainView"
             x:DataType="vm:MainViewModel">

    <!-- Root Grid with Dialog Overlay -->
    <Grid Background="{DynamicResource BackgroundPrimaryColor}">
        <Grid ColumnDefinitions="Auto,*">

            <Grid Grid.Column="0" IsVisible="{Binding IsSidebarVisible}">
                <!-- Backdrop (mobile only) - positioned over entire window -->
                <Border Background="{DynamicResource ModalOverlay}"
                        IsVisible="{Binding IsMobileLayout}"
                        Tapped="OnSidebarBackdropTapped"
                        HorizontalAlignment="Stretch"
                        Margin="-280,0,0,0"
                        Width="2000" />

                <Border Width="280"
                        Margin="6"
                        Background="{DynamicResource BackgroundTertiary}"
                        BorderBrush="{DynamicResource AccentSubtle}"
                        BorderThickness="1"
                        CornerRadius="12"
                        ClipToBounds="True"
                        BoxShadow="0 2 12 0 #30000000"
                        Tapped="OnSidebarContentTapped">
                    <Border.RenderTransform>
                        <TranslateTransform X="{Binding SidebarTranslateX}">
                            <TranslateTransform.Transitions>
                                <Transitions>
                                    <DoubleTransition Property="X" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                                </Transitions>
                            </TranslateTransform.Transitions>
                        </TranslateTransform>
                    </Border.RenderTransform>

                    <Grid RowDefinitions="*,Auto">
                        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                            <StackPanel Spacing="4" Margin="12">
                                <TextBlock Text="My Calendars"
                                           FontWeight="SemiBold"
                                           FontSize="13"
                                           Foreground="{DynamicResource ForegroundMuted}"
                                           Margin="4,8,4,8" />

                                <ItemsControl ItemsSource="{Binding Calendars}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="Transparent"
                                                    CornerRadius="8"
                                                    Padding="8,10"
                                                    Margin="0,1">
                                                <Border.Styles>
                                                    <Style Selector="Border:pointerover">
                                                        <Setter Property="Background" Value="{DynamicResource BackgroundHover}" />
                                                    </Style>
                                                </Border.Styles>
                                                <CheckBox IsChecked="{Binding IsVisible}">
                                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                                        <Ellipse Width="10"
                                                                 Height="10"
                                                                 Fill="{Binding Color}" />
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="13"
                                                                   Foreground="{DynamicResource ForegroundPrimary}" />
                                                    </StackPanel>
                                                </CheckBox>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Button Command="{Binding CreateNewCalendarCommand}"
                                        IsVisible="{Binding HasNoCalendars}"
                                        Classes="link"
                                        HorizontalAlignment="Left"
                                        Margin="4,10,0,0">
                                    <StackPanel Orientation="Horizontal" Spacing="7">
                                        <avalonia:SymbolIcon Symbol="AddCircle"
                                                             Width="12"
                                                             Height="12"
                                                             VerticalAlignment="Center" />
                                        <TextBlock Text="New Local Calendar" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </ScrollViewer>

                        <Border Grid.Row="1"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="0,1,0,0"
                                Padding="12,8">
                            <Button Command="{Binding OpenSettingsCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="8,10"
                                    CornerRadius="8"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left">
                                <Button.Styles>
                                    <Style Selector="Button:pointerover">
                                        <Setter Property="Background" Value="{DynamicResource BackgroundHover}" />
                                    </Style>
                                </Button.Styles>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <PathIcon Data="M12.012 2.25c.734.008 1.465.093 2.182.253a.75.75 0 0 1 .582.649l.17 1.527a1.384 1.384 0 0 0 1.927 1.116l1.401-.615a.75.75 0 0 1 .85.174 9.792 9.792 0 0 1 2.204 3.792.75.75 0 0 1-.271.825l-1.242.916a1.381 1.381 0 0 0 0 2.226l1.243.915a.75.75 0 0 1 .272.826 9.797 9.797 0 0 1-2.204 3.792.75.75 0 0 1-.848.175l-1.407-.617a1.38 1.38 0 0 0-1.926 1.114l-.169 1.526a.75.75 0 0 1-.572.647 9.518 9.518 0 0 1-4.406 0 .75.75 0 0 1-.572-.647l-.168-1.524a1.382 1.382 0 0 0-1.926-1.11l-1.406.616a.75.75 0 0 1-.849-.175 9.798 9.798 0 0 1-2.204-3.796.75.75 0 0 1 .272-.826l1.243-.916a1.38 1.38 0 0 0 0-2.226l-1.243-.914a.75.75 0 0 1-.271-.826 9.793 9.793 0 0 1 2.204-3.792.75.75 0 0 1 .85-.174l1.4.615a1.387 1.387 0 0 0 1.93-1.118l.17-1.526a.75.75 0 0 1 .583-.65c.717-.159 1.45-.243 2.201-.252Zm0 1.5a9.135 9.135 0 0 0-1.354.117l-.109.977A2.886 2.886 0 0 1 6.525 7.17l-.898-.394a8.293 8.293 0 0 0-1.348 2.317l.798.587a2.881 2.881 0 0 1 0 4.643l-.799.588c.32.842.776 1.626 1.348 2.322l.905-.397a2.882 2.882 0 0 1 4.017 2.318l.11.984c.889.15 1.798.15 2.687 0l.11-.984a2.881 2.881 0 0 1 4.018-2.322l.905.396a8.296 8.296 0 0 0 1.347-2.318l-.798-.588a2.881 2.881 0 0 1 0-4.643l.796-.587a8.293 8.293 0 0 0-1.348-2.317l-.896.393a2.884 2.884 0 0 1-4.023-2.324l-.11-.976a8.988 8.988 0 0 0-1.333-.117ZM12 8.25a3.75 3.75 0 1 1 0 7.5 3.75 3.75 0 0 1 0-7.5Zm0 1.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"
                                              Foreground="{DynamicResource ForegroundMuted}"
                                              Width="16"
                                              Height="16" />
                                    <TextBlock Text="Settings"
                                               FontSize="13"
                                               Foreground="{DynamicResource ForegroundMuted}" />
                                </StackPanel>
                            </Button>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

            <Grid Grid.Column="1" RowDefinitions="Auto,*">
                <!-- Top Navigation Bar -->
                <Border Grid.Row="0"
                        Margin="0,6,6,0"
                        Background="{DynamicResource BackgroundSecondary}"
                        CornerRadius="12,12,0,0"
                        Padding="16,12">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button Grid.Column="0"
                                IsVisible="{Binding IsMobileLayout}"
                                Command="{Binding ToggleSidebarCommand}"
                                Classes="modern"
                                Width="40"
                                Padding="8"
                                Margin="0,0,10,0">
                            <avalonia:SymbolIcon Symbol="Navigation" FontSize="20" />
                        </Button>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                            <Button Content="Today"
                                    Command="{Binding GoToTodayCommand}"
                                    Classes="modern" />
                            <Button Content="◄"
                                    Command="{Binding PreviousPeriodCommand}"
                                    Classes="modern"
                                    MinWidth="36" />
                            <Button Content="►"
                                    Command="{Binding NextPeriodCommand}"
                                    Classes="modern"
                                    MinWidth="36" />
                            <TextBlock Text="{Binding CurrentPeriodDisplay}"
                                       VerticalAlignment="Center"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource ForegroundPrimary}"
                                       Margin="10,0,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                            <controls:SegmentedControl SelectedIndex="{Binding ViewModeIndex}">
                                <x:String>Day</x:String>
                                <x:String>Week</x:String>
                                <x:String>Month</x:String>
                            </controls:SegmentedControl>
                            <Button Command="{Binding CreateEventCommand}"
                                    Classes="accent">
                                <StackPanel Orientation="Horizontal" Spacing="7">
                                    <PathIcon Data="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2Zm0 5a.75.75 0 0 0-.743.648l-.007.102v3.5h-3.5a.75.75 0 0 0-.102 1.493l.102.007h3.5v3.5a.75.75 0 0 0 1.493.102l.007-.102v-3.5h3.5a.75.75 0 0 0 .102-1.493l-.102-.007h-3.5v-3.5A.75.75 0 0 0 12 7Z"
                                              Foreground="{DynamicResource ForegroundPrimary}"
                                              Width="16"
                                              Height="16"/>
                                    <TextBlock Text="New Event" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Row="1"
                        Margin="0,0,6,6"
                        Background="{DynamicResource BackgroundPrimary}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="0,0,12,12"
                        ClipToBounds="True">
                    <ContentControl Content="{Binding CalendarViewModel}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:CalendarView />
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </Border>
            </Grid>
        </Grid>

        <!-- Event Dialog Overlay -->
        <Border IsVisible="{Binding IsEventDialogOpen}"
                Background="{DynamicResource ModalOverlay}"
                Tapped="OnOverlayTapped">
            <Grid HorizontalAlignment="Stretch"
                  VerticalAlignment="Center"
                  Tapped="OnDialogContentTapped">
                <ContentControl Content="{Binding EventEditViewModel}"
                                HorizontalAlignment="Stretch">
                    <ContentControl.ContentTemplate>
                        <DataTemplate>
                            <views:EventEditView />
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>
            </Grid>
        </Border>

        <!-- Settings Dialog Overlay -->
        <Border IsVisible="{Binding IsSettingsDialogOpen}"
                Background="{DynamicResource ModalOverlay}"
                Tapped="OnSettingsOverlayTapped">
            <Grid HorizontalAlignment="Stretch"
                  VerticalAlignment="Center"
                  Tapped="OnDialogContentTapped">
                <ContentControl Content="{Binding CalendarSettingsViewModel}"
                                HorizontalAlignment="Stretch">
                    <ContentControl.ContentTemplate>
                        <DataTemplate>
                            <views:CalendarSettingsView />
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>
            </Grid>
        </Border>
    </Grid>
</UserControl>
