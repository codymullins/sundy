<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Sundy.ViewModels"
             xmlns:views="using:Sundy.Views"
             x:Class="Sundy.Views.CalendarSettingsView"
             x:DataType="vm:CalendarSettingsViewModel"
             MaxWidth="900"
             MinWidth="600"
             Height="650"
             HorizontalAlignment="Stretch"
             Margin="16,24">
    <Grid>
        <Border Background="{DynamicResource ModalBackground}"
                BorderBrush="{DynamicResource ModalBorder}"
                BorderThickness="1"
                CornerRadius="8"
                BoxShadow="0 4 16 0 #80000000">
            <Grid ColumnDefinitions="200,*">
                <!-- Left Sidebar -->
                <Border Grid.Column="0"
                        Background="{DynamicResource BackgroundSecondary}"
                        CornerRadius="8,0,0,8"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,1,0">
                    <Grid RowDefinitions="Auto,*">
                        <!-- Sidebar Header -->
                        <TextBlock Grid.Row="0"
                                   Text="Settings"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource ForegroundPrimary}"
                                   Margin="16,20,16,16" />

                        <!-- Sidebar Navigation -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <StackPanel Spacing="4" Margin="8,0,8,16">
                                <!-- General Section Button -->
                                <Button Command="{Binding SetSectionCommand}"
                                        CommandParameter="General"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Padding="12,10"
                                        Tag="{Binding SelectedSection, Converter={StaticResource EqualityConverter}, ConverterParameter=General}">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="CornerRadius" Value="8" />
                                            <Setter Property="BorderThickness" Value="0" />
                                        </Style>
                                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource BackgroundHover}" />
                                        </Style>
                                        <Style Selector="Button[Tag=True]">
                                            <Setter Property="Background" Value="{DynamicResource AccentBackground}" />
                                            <Setter Property="BorderThickness" Value="3,0,0,0" />
                                            <Setter Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                            <Setter Property="Padding" Value="9,10" />
                                        </Style>
                                        <Style Selector="Button[Tag=True]:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="#352060" />
                                        </Style>
                                    </Button.Styles>
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Width="16" Height="16"
                                                  Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
                                                  Foreground="{DynamicResource ForegroundPrimary}" />
                                        <TextBlock Text="General"
                                                   FontSize="14"
                                                   Foreground="{DynamicResource ForegroundPrimary}" />
                                    </StackPanel>
                                </Button>

                                <!-- Integrations Section Button -->
                                <Button Command="{Binding SetSectionCommand}"
                                        CommandParameter="Integrations"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Padding="12,10"
                                        Tag="{Binding SelectedSection, Converter={StaticResource EqualityConverter}, ConverterParameter=Integrations}">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="CornerRadius" Value="8" />
                                            <Setter Property="BorderThickness" Value="0" />
                                        </Style>
                                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource BackgroundHover}" />
                                        </Style>
                                        <Style Selector="Button[Tag=True]">
                                            <Setter Property="Background" Value="{DynamicResource AccentBackground}" />
                                            <Setter Property="BorderThickness" Value="3,0,0,0" />
                                            <Setter Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                            <Setter Property="Padding" Value="9,10" />
                                        </Style>
                                        <Style Selector="Button[Tag=True]:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="#352060" />
                                        </Style>
                                    </Button.Styles>
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Width="16" Height="16"
                                                  Data="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                                                  Foreground="{DynamicResource ForegroundPrimary}" />
                                        <TextBlock Text="Integrations"
                                                   FontSize="14"
                                                   Foreground="{DynamicResource ForegroundPrimary}" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Right Content Area -->
                <Grid Grid.Column="1" Margin="24" RowDefinitions="*,Auto">
                    <!-- General Section Content -->
                    <ScrollViewer Grid.Row="0"
                                  IsVisible="{Binding SelectedSection, Converter={StaticResource EqualityConverter}, ConverterParameter=General}"
                                  MaxHeight="500">
                        <views:GeneralSettingsViewContent DataContext="{Binding}" />
                    </ScrollViewer>

                    <!-- Integrations Section Content -->
                    <ScrollViewer Grid.Row="0"
                                  IsVisible="{Binding SelectedSection, Converter={StaticResource EqualityConverter}, ConverterParameter=Integrations}"
                                  MaxHeight="500">
                        <views:IntegrationSettingsViewContent DataContext="{Binding}" />
                    </ScrollViewer>

                    <!-- Close Button -->
                    <Button Grid.Row="1"
                            Content="Close"
                            Command="{Binding CloseCommand}"
                            Classes="accent"
                            HorizontalAlignment="Right"
                            MinWidth="100"
                            Margin="0,20,0,0" />
                </Grid>
            </Grid>
        </Border>

        <!-- Delete Confirmation Dialog Overlay -->
        <Border IsVisible="{Binding IsDeleteConfirmationOpen}"
                Background="{DynamicResource ModalOverlay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <Border Background="{DynamicResource ModalBackground}"
                    BorderBrush="{DynamicResource ModalBorder}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24"
                    MaxWidth="400"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 4 16 0 #40000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="Delete Calendar?"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundPrimary}" />

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource ForegroundPrimary}">
                        <Run Text="Are you sure you want to delete " />
                        <Run Text="{Binding CalendarToDelete.Name, FallbackValue='this calendar'}"
                             FontWeight="SemiBold" />
                        <Run Text="? This will permanently delete all events in this calendar and cannot be undone." />
                    </TextBlock>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Command="{Binding CancelDeleteCommand}"
                                Classes="modern full-width"
                                IsEnabled="{Binding !IsDeleting}" />
                        <Button Grid.Column="1"
                                Content="Delete"
                                Command="{Binding ConfirmDeleteCommand}"
                                Classes="danger full-width"
                                IsEnabled="{Binding !IsDeleting}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Border>

        <!-- Reset Database Confirmation Dialog Overlay -->
        <Border IsVisible="{Binding IsResetConfirmationOpen}"
                Background="{DynamicResource ModalOverlay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <Border Background="{DynamicResource ModalBackground}"
                    BorderBrush="{DynamicResource ModalBorder}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24"
                    MaxWidth="450"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 4 16 0 #40000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="Reset Database?"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundPrimary}" />

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource ForegroundPrimary}">
                        <Run
                            Text="Are you sure you want to completely reset the database? This will permanently delete:" />
                    </TextBlock>

                    <StackPanel Spacing="4" Margin="16,0,0,0">
                        <TextBlock Text="• All calendars" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All events" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All blocking relationships" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All other data" Foreground="{DynamicResource ForegroundPrimary}" />
                    </StackPanel>

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource DangerPrimary}"
                               FontWeight="SemiBold"
                               Text="This action cannot be undone!" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Command="{Binding CancelResetCommand}"
                                Classes="modern full-width"
                                IsEnabled="{Binding !IsResettingDatabase}" />
                        <Button Grid.Column="1"
                                Content="Reset Database"
                                Command="{Binding ConfirmResetCommand}"
                                Classes="danger full-width"
                                IsEnabled="{Binding !IsResettingDatabase}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>
