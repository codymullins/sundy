<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Sundy.ViewModels"
             x:Class="Sundy.Views.CalendarSettingsView"
             x:DataType="vm:CalendarSettingsViewModel"
             Width="700">

    <Grid>
        <Border Background="{DynamicResource ModalBackground}"
                BorderBrush="{DynamicResource ModalBorder}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="24"
                BoxShadow="0 4 16 0 #80000000">
            <Grid RowDefinitions="Auto,*,Auto,Auto,Auto">
                <!-- Header -->
                <TextBlock Grid.Row="0"
                           Text="Calendar Settings"
                           FontSize="24"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource ForegroundPrimary}"
                           Margin="0,0,0,24" />

                <!-- Calendar List -->
                <ScrollViewer Grid.Row="1" MaxHeight="400">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Calendars"
                                   FontWeight="SemiBold"
                                   FontSize="16"
                                   Foreground="{DynamicResource ForegroundPrimary}"
                                   Margin="0,0,0,8" />

                        <!-- Empty state -->
                        <TextBlock Text="No calendars yet. Create one below."
                                   Foreground="{DynamicResource ForegroundDisabled}"
                                   FontStyle="Italic"
                                   IsVisible="{Binding !Calendars.Count}" />

                        <!-- Calendar items -->
                        <ItemsControl ItemsSource="{Binding Calendars}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="16"
                                            Margin="0,0,0,8"
                                            Background="{DynamicResource BackgroundSecondary}">
                                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                                            <!-- Calendar Color and Name -->
                                            <Border Grid.Row="0" Grid.Column="0"
                                                    Width="24"
                                                    Height="24"
                                                    Background="{Binding Color}"
                                                    CornerRadius="6"
                                                    VerticalAlignment="Center"
                                                    Margin="0,0,12,0" />

                                            <TextBlock Grid.Row="0" Grid.Column="1"
                                                       Text="{Binding Name}"
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource ForegroundPrimary}"
                                                       VerticalAlignment="Center" />

                                            <!-- Delete Button -->
                                            <Button Grid.Row="0" Grid.Column="2"
                                                    Content="Delete"
                                                    Command="{Binding DeleteCommand}"
                                                    CommandParameter="{Binding}"
                                                    Classes="danger"
                                                    VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- New Calendar Section -->
                <Border Grid.Row="2"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="0,20,0,0"
                        Margin="0,20,0,0">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Create New Calendar"
                                   FontWeight="SemiBold"
                                   FontSize="16"
                                   Foreground="{DynamicResource ForegroundPrimary}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                            <TextBox Grid.Column="0"
                                     Text="{Binding NewCalendarName}"
                                     Watermark="Calendar name"
                                     Height="36" />
                            <Button Grid.Column="1"
                                    Content="Create"
                                    Command="{Binding CreateCalendarCommand}"
                                    Classes="accent"
                                    MinWidth="100" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Database Management Section -->
                <Border Grid.Row="3"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="0,20,0,0"
                        Margin="0,20,0,0">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Database Management"
                                   FontWeight="SemiBold"
                                   FontSize="16"
                                   Foreground="{DynamicResource ForegroundPrimary}" />

                        <TextBlock TextWrapping="Wrap"
                                   Foreground="{DynamicResource ForegroundSecondary}"
                                   FontSize="13"
                                   Text="Warning: This will permanently delete all local data. This action cannot be undone." />

                        <Button Content="Reset Database"
                                Command="{Binding ResetDatabaseCommand}"
                                Classes="danger"
                                HorizontalAlignment="Left"
                                MinWidth="150"
                                IsEnabled="{Binding !IsResettingDatabase}" />
                    </StackPanel>
                </Border>

                <!-- Close Button -->
                <Button Grid.Row="4"
                        Content="Close"
                        Command="{Binding CloseCommand}"
                        Classes="modern"
                        HorizontalAlignment="Right"
                        MinWidth="100"
                        Margin="0,20,0,0" />
            </Grid>
        </Border>

        <!-- Delete Confirmation Dialog Overlay -->
        <Border IsVisible="{Binding IsDeleteConfirmationOpen}"
                Background="{DynamicResource ModalOverlay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <Border Background="{DynamicResource ModalBackground}"
                    BorderBrush="{DynamicResource ModalBorder}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24"
                    MaxWidth="400"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 4 16 0 #40000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="Delete Calendar?"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundPrimary}" />

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource ForegroundPrimary}">
                        <Run Text="Are you sure you want to delete " />
                        <Run Text="{Binding CalendarToDelete.Name, FallbackValue='this calendar'}"
                             FontWeight="SemiBold" />
                        <Run Text="? This will permanently delete all events in this calendar and cannot be undone." />
                    </TextBlock>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Command="{Binding CancelDeleteCommand}"
                                Classes="modern full-width"
                                IsEnabled="{Binding !IsDeleting}" />
                        <Button Grid.Column="1"
                                Content="Delete"
                                Command="{Binding ConfirmDeleteCommand}"
                                Classes="danger full-width"
                                IsEnabled="{Binding !IsDeleting}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Border>

        <!-- Reset Database Confirmation Dialog Overlay -->
        <Border IsVisible="{Binding IsResetConfirmationOpen}"
                Background="{DynamicResource ModalOverlay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <Border Background="{DynamicResource ModalBackground}"
                    BorderBrush="{DynamicResource ModalBorder}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24"
                    MaxWidth="450"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 4 16 0 #40000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="Reset Database?"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundPrimary}" />

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource ForegroundPrimary}">
                        <Run
                            Text="Are you sure you want to completely reset the database? This will permanently delete:" />
                    </TextBlock>

                    <StackPanel Spacing="4" Margin="16,0,0,0">
                        <TextBlock Text="• All calendars" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All events" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All blocking relationships" Foreground="{DynamicResource ForegroundPrimary}" />
                        <TextBlock Text="• All other data" Foreground="{DynamicResource ForegroundPrimary}" />
                    </StackPanel>

                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource DangerPrimary}"
                               FontWeight="SemiBold"
                               Text="This action cannot be undone!" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Command="{Binding CancelResetCommand}"
                                Classes="modern full-width"
                                IsEnabled="{Binding !IsResettingDatabase}" />
                        <Button Grid.Column="1"
                                Content="Reset Database"
                                Command="{Binding ConfirmResetCommand}"
                                Classes="danger full-width"
                                IsEnabled="{Binding !IsResettingDatabase}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>